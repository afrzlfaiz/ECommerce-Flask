{% extends "base.html" %}
{% set title = "Register Â· ShopEasy" %}
{% block content %}
<div class="max-w-md mx-auto">
  <h1 class="text-2xl font-semibold mb-6">Daftar</h1>
  <form id="register-form" class="space-y-4">
    <input type="email" name="email" placeholder="Email" class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-transparent" required>
    <input type="password" name="password" placeholder="Password" class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-transparent" required>
    <input type="password" name="password_confirm" placeholder="Konfirmasi Password" class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-700 bg-transparent" required>
    <button class="w-full px-4 py-2 rounded-xl bg-brand text-white hover:bg-blue-600">Daftar</button>
  </form>

  <div class="my-6 text-sm text-center text-slate-500">atau</div>

  <!-- Tombol Register Google -->
  <button id="google-register"
          class="w-full flex items-center justify-center gap-3 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800">
    <img src="{{ url_for('static', filename='images/google.svg') }}" alt="Google Logo" class="w-5 h-5">
    <span>Daftar dengan Google</span>
  </button>

  <div class="mt-4 text-sm">
    Sudah punya akun? <a class="text-brand hover:underline" href="{{ url_for('main.login') }}">Masuk</a>
  </div>
</div>

<!-- Supabase JS (CDN) + handler OAuth -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "{{ config['SUPABASE_URL'] }}";
  const SUPABASE_ANON_KEY = "{{ config['SUPABASE_ANON_KEY'] }}";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  document.getElementById('google-register')?.addEventListener('click', async () => {
    try {
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          redirectTo: `${window.location.origin}/auth/callback`,
          // minta refresh_token (offline)
          queryParams: { access_type: 'offline', prompt: 'consent' }
        }
      });
      if (error) throw error;
      // Supabase akan redirect; tidak perlu lanjut di sini
    } catch (e) {
      console.error(e);
      alert('Gagal membuka Google OAuth');
    }
  });
</script>
{% endblock %}
