{% set title = title or "Eâ€‘Commerce" %}
<!doctype html>
<html lang="id" x-data x-init="$nextTick(()=>{ window.__initCartBadge && __initCartBadge(); })"
      class="scroll-smooth"
>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
  // Theme bootstrap (before Tailwind to avoid FOUC)
  (function() {
    try {
      const theme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (theme === 'dark' || (!theme && prefersDark)) {
        document.documentElement.classList.add('dark');
      }
    } catch(e) {}
  })();
  
  // Initialize auth status
  window.__userSession = null;
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'] },
          colors: {
            brand: '#2563EB'
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-white text-slate-800 dark:bg-slate-900 dark:text-slate-100 font-sans">
  <!-- Navbar -->
  <header class="sticky top-0 z-50 backdrop-blur bg-white/70 dark:bg-slate-900/70 border-b border-slate-200 dark:border-slate-800">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <a href="{{ url_for('main.home') }}" class="flex items-center gap-2 font-semibold">
        <span class="inline-flex w-8 h-8 rounded-xl bg-brand/10 text-brand items-center justify-center">ðŸ›’</span>
        <span class="tracking-tight">ShopEasy</span>
      </a>
      <div class="flex items-center gap-6 text-sm">
        <a href="{{ url_for('main.home') }}" class="hover:text-brand">Home</a>
        <a href="{{ url_for('main.products') }}" class="hover:text-brand">Produk</a>
        <a href="{{ url_for('main.cart') }}" class="hover:text-brand flex items-center gap-2">
          Cart
          <span id="cart-badge" class="inline-flex items-center justify-center h-5 min-w-[1.25rem] px-1 text-xs rounded-full bg-brand text-white">0</span>
        </a>
        <a href="{{ url_for('main.orders') }}" class="hover:text-brand">Orders</a>
        <a id="logout-link" href="#" class="hover:text-brand" style="display:none"
           onclick="event.preventDefault(); window.__logout && window.__logout();">Logout</a>
        <a id="login-link" href="{{ url_for('main.login') }}" class="hover:text-brand" style="display:none">
          Login/Register
        </a>
        <!-- Theme toggle -->
        <button id="theme-toggle" class="p-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800">
          <span id="theme-icon">ðŸŒ™</span>
        </button>
      </div>
    </nav>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    {% block content %}{% endblock %}
  </main>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Footer -->
  <footer class="py-10 border-t border-slate-200 dark:border-slate-800 text-sm text-slate-500">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between">
      <p>&copy; {{ 2025 }} ShopEasy. All rights reserved.</p>
      <p>Built with Flask Â· Tailwind Â· Alpine</p>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
